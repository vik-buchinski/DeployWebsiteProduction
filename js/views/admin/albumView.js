define(["server","local-storage","constants","common"],function(a,b,c,d){return{init:function(){window.app.views.AdminAlbum||(window.app.views.AdminAlbum=Backbone.View.extend({initialize:function(a){this.album_data=a.album_data,this.title=a.title,this.selected_page=a.selected_page},render:function(){return document.title=this.title,this.$el.html(this.MainContainerTemplate({all_pages:c.LEFT_PANELS,album_types:c.ALBUM_TYPES,selected_page:this.selected_page})),$(this.$el).find(".main").html(this.template({data:this.album_data})),$(this.$el).find("textarea#album-description").ckeditor({language:c.APP_LANGUAGE}),this},events:{"click #delete-btn":"deletePhoto","click #edit-btn":"editPhoto","click #submit-btn":"addImageSubmit","change #adding-image":"addFileChanged","change #album-image":"albumImageChanged","change #edit-avatar-image":"editFileChanged","click #save-album-btn":"updateAlbumData"},updateAlbumData:function(){var e=null;if(!this.album_data.is_expaned&&(e=$("#album-image")[0].files[0])){if(!d.isImage(e))return alert($.i18n.t("supported-format-message")+c.SUPPORTED_IMAGES_FORMAT),!1;var f=$("#album-image")[0].files[0].size;if(f>c.MAX_UPLOADS_FILE_SIZE)return $("#album-image").val(""),alert($.i18n.t("max-file-size-message")+c.MAX_UPLOADS_FILE_SIZE/1024/1024+$.i18n.t("mb-prefix")),!1}var g;return g=$("#is-album-visible").is(":checked")?!0:!1,a.editAdminAlbum(b.getSession().session.token,e,$("#album-description").val(),$("#album-name").val(),this.album_data.id,g,function(a){alert($.i18n.t("saved-message")),window.location.reload()}),!1},albumImageChanged:function(){var a=$("#album-image")[0].files[0];if(d.isImage(a)){var b=$("#album-image")[0].files[0].size;if(b>c.MAX_UPLOADS_FILE_SIZE)return $("#album-image").val(""),alert($.i18n.t("max-file-size-message")+c.MAX_UPLOADS_FILE_SIZE/1024/1024+$.i18n.t("mb-prefix")),!1;var e=new FileReader;e.onload=function(a){$("#album-image-preview").attr("src",a.target.result)},e.readAsDataURL($("#album-image")[0].files[0])}else $("#album-image").val(""),alert($.i18n.t("supported-format-message")+c.SUPPORTED_IMAGES_FORMAT)},addFileChanged:function(){var a=$("#adding-image")[0].files[0];if(d.isImage(a)){var b=$("#adding-image")[0].files[0].size;if(b>c.MAX_UPLOADS_FILE_SIZE)return $("#adding-image").val(""),alert($.i18n.t("max-file-size-message")+c.MAX_UPLOADS_FILE_SIZE/1024/1024+$.i18n.t("mb-prefix")),!1;var e=new FileReader;e.onload=function(a){$("#adding-image-preview").attr("src",a.target.result)},e.readAsDataURL($("#adding-image")[0].files[0])}else $("#adding-image").val(""),alert($.i18n.t("supported-format-message")+c.SUPPORTED_IMAGES_FORMAT)},editFileChanged:function(){var a=$("#edit-avatar-image")[0].files[0];if(d.isImage(a)){var b=a.size;if(b>c.MAX_UPLOADS_FILE_SIZE)return $("#edit-avatar-image").val(""),alert($.i18n.t("max-file-size-message")+c.MAX_UPLOADS_FILE_SIZE/1024/1024+$.i18n.t("mb-prefix")),!1;var e=new FileReader;e.onload=function(a){$("#edit-image").attr("src",a.target.result)},e.readAsDataURL($("#edit-avatar-image")[0].files[0])}else $("#edit-avatar-image").val(""),alert($.i18n.t("supported-format-message")+c.SUPPORTED_IMAGES_FORMAT)},addImageSubmit:function(){var e=$("#adding-image")[0].files[0];if(!e)return alert($.i18n.t("select-image-message")),!1;if(!d.isImage(e))return alert($.i18n.t("supported-format-message")+c.SUPPORTED_IMAGES_FORMAT),!1;var f=$("#adding-image")[0].files[0].size;return f>c.MAX_UPLOADS_FILE_SIZE?($("#adding-image").val(""),alert($.i18n.t("max-file-size-message")+c.MAX_UPLOADS_FILE_SIZE/1024/1024+$.i18n.t("mb-prefix")),!1):(a.addAdminAlbumImage(b.getSession().session.token,e,$("#image-description").val(),this.album_data.id,function(a){alert($.i18n.t("image-added-message")),window.location.reload()}),!1)},deletePhoto:function(c){var d=this;$("#confirm-modal").unbind().modal({backdrop:"static",keyboard:!1}).one("click","#confirm-delete-btn",function(e){a.deleteAdminAlbumImage(b.getSession().session.token,$(c.currentTarget).data("photo-number"),d.album_data.id,function(){$("#confirm-modal").modal("hide"),window.location.reload()})})},editPhoto:function(e){var f=this,g=$(e.currentTarget).data("photo-number"),h=_.find(this.album_data.images,function(a){return a.id==g});$("#edit-image").attr("src",h.image_url),$("#edit-image-description").val(h.description),$("#edit-photo-modal").unbind().modal({backdrop:"static",keyboard:!1}).one("click","#save-changes-btn",function(e){var h=$("#edit-avatar-image")[0].files[0];if(h){if(!d.isImage(h))return alert($.i18n.t("supported-format-message")+c.SUPPORTED_IMAGES_FORMAT),!1;var i=$("#edit-avatar-image")[0].files[0].size;if(i>c.MAX_UPLOADS_FILE_SIZE)return $("#edit-avatar-image").val(""),alert($.i18n.t("max-file-size-message")+c.MAX_UPLOADS_FILE_SIZE/1024/1024+$.i18n.t("mb-prefix")),!1}a.editAdminAlbumImage(b.getSession().session.token,$("#edit-avatar-image")[0].files[0],$("#edit-image-description").val(),g,f.album_data.id,function(){$("#edit-photo-modal").modal("hide"),window.location.reload()})})}}))}}});