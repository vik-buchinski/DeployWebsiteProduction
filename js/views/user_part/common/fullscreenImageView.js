define(["raphael","backbone"],function(a){return{init:function(){window.app.views.FullscreenImageView||(window.app.views.FullscreenImageView=Backbone.View.extend({nextImageId:null,prevImageId:null,isAnimationTriggering:!1,initialize:function(){this.listenTo(window.Vent,"setFullscreenImages",this.setImages),this.listenTo(window.Vent,"openFSImage",this.openFSImage)},setImages:function(a){this.images=a.images},events:{"click .fsbox-close":"closeBox","click a.fsbox-prev":"showPrev","click a.fsbox-next":"showNext"},openFSImage:function(a){this.displayImage(a.image_id),$(".fsbox").fadeIn(200),$("body").hasClass("fsbox-active")||$("body").addClass("fsbox-active")},closeBox:function(){$(".fsbox").show(),$(".fsbox").fadeOut(200,function(){$(".fsbox .slides img").attr("src","")}),$("body").removeClass("fsbox-active")},showNext:function(){this.displayImage(this.nextImageId)},showPrev:function(){this.displayImage(this.prevImageId)},displayImage:function(a){if(!this.isAnimationTriggering){for(var b=null,c=0;c<this.images.length;c++)if(this.images[c].id==a){b=this.images[c],0==c?$(".fsbox-prev").hasClass("disabled")||$(".fsbox-prev").addClass("disabled"):($(".fsbox-prev").hasClass("disabled")&&$(".fsbox-prev").removeClass("disabled"),this.prevImageId=this.images[c-1].id),c==this.images.length-1?$(".fsbox-next").hasClass("disabled")||$(".fsbox-next").addClass("disabled"):($(".fsbox-next").hasClass("disabled")&&$(".fsbox-next").removeClass("disabled"),this.nextImageId=this.images[c+1].id);break}if(!b)return void alert($.i18n.t("image-not-found-error"));var d=this;this.isAnimationTriggering=!0,$(".fsbox .slides img").fadeOut(100,function(){$(".fsbox .slides img").attr("src",b.image_url);var a="";b.description&&(a=b.description),$(".fsbox .slides img").attr("alt",a);var c=b.image_width,e=b.image_height,f=$(".fsbox .slides").width(),g=$(".fsbox .slides").height(),h=f/g,i=c/e;i>h?$(".fsbox .slides img").css({width:"100%",height:"auto"}):$(".fsbox .slides img").css({width:"auto",height:"100%"}),$(".fsbox .slides img").fadeIn(100),d.isAnimationTriggering=!1})}},box:"",renderArrow:function(b,c){var d=a($(b)[0],16,26);if("right"==c){d.path("M 2 2 L 14 13 L 2 24").attr({fill:"none","stroke-width":3})}else{d.path("M 15 2 L 2 13 L 15 24").attr({fill:"none","stroke-width":3})}},renderCross:function(b){var c=a($(b)[0],16,16);c.path("M 1 1 L 15 15 M 15 1 L 1 15").attr({fill:"none","stroke-width":3})},render:function(){this.renderArrow(".fsbox-prev"),this.renderArrow(".fsbox-next","right"),this.renderCross(".fsbox-close");$(window).width()-152,$(window).height()-152;return this}}))}}});