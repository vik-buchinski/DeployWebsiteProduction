define(["server","local-storage","constants","common"],function(a,b,c,d){return{init:function(){window.app.views.AdminAlbumsList||(window.app.views.AdminAlbumsList=Backbone.View.extend({initialize:function(a){this.album_data=a.album_data,this.title=a.title,this.album_type=a.album_type},render:function(){return document.title=this.title,this.$el.html(this.MainContainerTemplate({all_pages:c.LEFT_PANELS,album_types:c.ALBUM_TYPES,selected_page:this.album_type})),$(this.$el).find(".main").html(this.template({albums:this.album_data,album_type:this.album_type})),$(this.$el).find("textarea#album-description").ckeditor({language:c.APP_LANGUAGE}),this},events:{"click #delete-btn":"deleteAlbum","change #album-image":"albumImageChanged","click #save-album-btn":"addAlbum"},addAlbum:function(){var e=null;if(e=$("#album-image")[0].files[0],!e)return alert($.i18n.t("select-album-image-message")),!1;if(!d.isImage(e))return alert($.i18n.t("supported-format-message")+c.SUPPORTED_IMAGES_FORMAT),!1;var f=$("#album-image")[0].files[0].size;if(f>c.MAX_UPLOADS_FILE_SIZE)return $("#album-image").val(""),alert($.i18n.t("max-file-size-message")+c.MAX_UPLOADS_FILE_SIZE/1024/1024+$.i18n.t("mb-prefix")),!1;var g=$("#album-name").val();return g?(a.addAdminAlbum(b.getSession().session.token,e,$("#album-description").val(),g,this.album_type,function(a){alert($.i18n.t("added-message")),window.location.reload()}),!1):(alert($.i18n.t("album-name-missing-message")),!1)},albumImageChanged:function(){var a=$("#album-image")[0].files[0];if(d.isImage(a)){var b=$("#album-image")[0].files[0].size;if(b>c.MAX_UPLOADS_FILE_SIZE)return $("#album-image").val(""),alert($.i18n.t("max-file-size-message")+c.MAX_UPLOADS_FILE_SIZE/1024/1024+$.i18n.t("mb-prefix")),!1;var e=new FileReader;e.onload=function(a){$("#album-image-preview").attr("src",a.target.result)},e.readAsDataURL($("#album-image")[0].files[0])}else $("#album-image").val(""),alert($.i18n.t("supported-format-message")+c.SUPPORTED_IMAGES_FORMAT)},deleteAlbum:function(c){$("#confirm-modal").unbind().modal({backdrop:"static",keyboard:!1}).one("click","#confirm-delete-btn",function(d){a.deleteAdminAlbum(b.getSession().session.token,$(c.currentTarget).data("album-number"),function(){$("#confirm-modal").modal("hide"),window.location.reload()})})}}))}}});